<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>调入确认</title>
	<link rel="stylesheet" href="../css/iconfont.css">
	<link rel="stylesheet" href="../css/icon.css">
	<link rel="stylesheet" href="../css/bootstrap.css"> 
	<link rel="stylesheet" href="../css/dialog.css"> 
    <link rel="stylesheet" href="../css/index.css">
    <style>
    .cardList li{height:auto;}
    .cadI,.backF{display: none;}
    </style>
</head>
<body>
	<nav>
		<a class="back centery backT" href="javascript:history.go(-1)">返回</a> 
		<a class="back centery backF" href="javascript:;">返回</a> 
		<p class="navCon">调入确认</p>
	</nav>
	<div class="content destoryC formEntry">  
        <div class="cardList cadL"> 
            <ul id="list">

            </ul>  
        </div> 
        <div class="cardList cadI"> 
            <ul id="list2">

            </ul>     
            <form action="" id="form1">
                <p>
                    <label for="storePlace">存放地点</label> 
                    <select name="storePlace" value="02" id="storePlace">
                        <option value="02">炼化装置</option>
                        <option value="0201">   烷基化车间烷基化装置</option>
                        <option value="0202">   延迟焦化车间延迟焦化装置</option>
                        <option value="0203">   PSA装置</option>
                        <option value="0204">   烷基化车间</option>
                        <option value="03">   办公场所</option>
                        <option value="0301">   办公场所-办公区</option>
                        <option value="0302">   办公场所-餐厅</option>
                        <option value="0303">   办公场所-活动室</option>
                        <option value="0304">   办公场所-库房</option>
                        <option value="0305">   办公场所-车库</option>
                        <option value="04">   加油(气)站</option>
                        <option value="0401">   加油(气)站-加油现场</option>
                        <option value="0402">   加油(气)站-便利店</option>
                        <option value="0403">   加油(气)站-办公区</option>
                        <option value="0404">   加油(气)站-配电房</option>
                        <option value="0405">   加油(气)站-宿舍</option>
                        <option value="0406">   加油(气)站-厨房</option>
                        <option value="0407">   加油(气)站-餐厅</option>
                        <option value="0408">   加油(气)站-生活区</option>
                        <option value="0409">   加油(气)站-油罐区</option>
                        <option value="0410">   加油(气)站-库房</option>
                        <option value="0411">   加油(气)站-卫生间</option>
                        <option value="05">   油(气)库</option>
                        <option value="0501">   油(气)库-库区</option>
                        <option value="0502">   油(气)库-办公区</option>
                        <option value="0503">   油(气)库-配电房</option>
                        <option value="0504">   油(气)库-宿舍</option>
                        <option value="0505">   油(气)库-厨房</option>
                        <option value="0506">   油(气)库-餐厅</option>
                        <option value="0507">   油(气)库-库房</option>
                        <option value="0508">   油(气)库-油码头作业区</option>
                        <option value="0509">   油(气)库-收发油区</option>
                        <option value="0510">   油(气)库-化验室</option>
                        <option value="0511">   油(气)库-计量室</option>
                        <option value="0512">   油(气)库-收发油泵房</option>
                        <option value="0513">   油(气)库-消防泵房</option>
                        <option value="0514">   油(气)库-锅炉房</option>
                        <option value="0515">   油(气)库-空压机房</option>
                        <option value="0516">   油(气)库-铁路作业区</option>
                        <option value="0517">   油(气)库-门卫</option>
                        <option value="0518">   油(气)库-卫生间</option>
                        <option value="06">   水上加油站</option>
                        <option value="0601">   水上加油站-加油船</option>
                        <option value="07">   管理站</option>
                        <option value="0701">   管理站-操作间</option>
                        <option value="0702">   管理站-泵房</option>
                        <option value="99">   其他</option> 
                    </select>
                </p>  
                <p>
                    <label for="technicalCondition">技术状况</label> 
                    <select name="technicalCondition" value="01" id="technicalCondition">
                        <option value="01">完好</option>
                        <option value="02">带病运行</option>
                        <option value="03">在修</option>
                        <option value="04">待修</option>
                        <option value="05">待报废</option>
                        <option value="06">损毁</option>
                        <option value="07">待处置</option>
                        <option value="08">已处置</option>
                    </select>
                </p>
                <p>
                    <label for="entityCode">资产组</label> 
                    <select name="entityCode" value="01" id="entityCode">
                        <option value="099000000050004">重庆销售公司本部</option>
                        <option value="099000000050005">重庆销售渝中公司</option>
                        <option value="099000000050006">重庆销售江南公司</option>
                        <option value="099000000050007">重庆销售江北公司</option>
                        <option value="099000000050008">重庆销售永川公司</option>
                        <option value="099000000050009">重庆销售万州公司</option>
                        <option value="099000000050010">重庆销售涪陵公司</option>
                        <option value="099000000050011">重庆销售黔江公司</option>
                        <option value="099000000050012">重庆销售非油公司</option>
                        <option value="099000000050013">重庆销售燃料公司</option>
                        <option value="099000000050014">重庆销售中油现代交通油料有限责任公司</option>
                        <option value="099000000050015">重庆销售中油迅发实业有限责任公司</option>
                        <option value="099000000050016">重庆销售重庆市石油总公司华岩加油站</option>
                        <option value="099000000050017">重庆销售中油重庆小泉加油站</option>
                        <option value="099000000050018">重庆销售荣昌县中油川荣石油有限责任公司</option>
                        <option value="099000000050019">重庆销售荣昌县昌州石油有限责任公司</option>
                        <option value="099000000050020">重庆销售中油芙武有限责任公司</option>
                        <option value="099000000050021">重庆销售中油铁发渝遂有限责任公司</option>
                        <option value="099000000050022">重庆销售重庆中油诚源发展有限公司</option>
                        <option value="099000000050023">重庆销售仓储公司</option> 
                    </select>
                </p>
                <p>
                    <label for="userPerson">保管人</label>
                    <input type="text" name="userPerson" placeholder="保管人">
                </p>
                <p>
                    <label for="wbsDepreciate">项目信息</label>
                    <input type="text" name="wbsDepreciate" placeholder="项目信息">
                </p>
                <p>
                    <label for="erpAufnr">内部订单</label>
                    <input type="text" name="erpAufnr" placeholder="内部订单">
                </p>
                <p>
                    <label for="erpKtext">订单描述</label>
                    <input type="text" name="erpKtext" placeholder="订单描述">
                </p>
                <p>
                    <label for="wbsTxt">WBS描述</label>
                    <input type="text" name="wbsTxt" placeholder="WBS描述">
                </p>
            </form> 
            <bottom class=" bottomFixed BtnCurrent"> 
                    <button id="submitBtn2" class="bottomBtn center  iconfont icon-tijiao"></button> 
                </bottom>
        </div>
	</div> 
</body>
<script src="../js/jquery.min.js"></script>
<script src="../js/dialog.js"></script>
<script src="../js/cookie.js"></script>
<script src="../js/fancySelect.js"></script>
<script src="../js/hotcss.js"></script>
<script src="../js/doT.js"></script>
<script src="../js/main.js"></script>   
<script type="template" id="listCon1">  
    {{~it.data :value:index}}
        <li class="clearfix"  data-ph={{= value.phoneInvoiceNumber }} data-index={{=index}} onclick='check(this)'>  
           <span class="listInfo">
                <b>单据号 ：<i class="phoneNumber">{{= value.phoneInvoiceNumber }}</i></b>
                <b>申请人 ：<i>{{= value.auditUser}}</i></b>       
            </span> 
            <div class=" chose bottomBtn iconfont icon-tijiao" '></div> 
        </li>
    {{~}}
</script> 
<script type="template" id="listCon2">  
    {{~it.data :value:index}}
        <li class="clearfix" data-ph={{= value.phoneInvoiceNumber }} data-id={{= value.id}} onclick='check2(this)'>  
            <span class="listInfo">
                <b>单据号 ：<i class="phoneNumber">{{= value.phoneInvoiceNumber }}</i></b>
                {{? !value.userPerson}} 
                <b>保管人 ：<i>--</i></b>    
                    {{??}}   
                
                    <b>保管人 ：<i>{{= value.userPerson}}</i></b>  
                {{?}}     
            </span> 
            <div class=" chose bottomBtn iconfont icon-tijiao" '></div> 
        </li>
    {{~}}
</script> 
<script>    
// var departList = $.cookie('departList');
var departList = localStorage.getItem('departList');

var userInfo = $.cookie('userinfo');  
departList = JSON.parse(departList)[0];
userInfo = JSON.parse(userInfo); 
var ScrapList=[] ;
var JSONnull={};
$("select").fancySelect(); 
getDate();
 
$("#submitBtn1").click(function(){ 
    $('#scan1').show();
    if($("#list .chose.active").length<=0){
        alert("请选择单据");
        return false;
    }
    var updataUrl=getURL()+'/mobile/allotController.do?allotIn';
    var paArr='';
    var arr =$("#list .chose.active").closest("li");
    $.each(arr,function(){
        paArr+=$(this).attr("data-ph")+',' 
    })
    var jsons = {  
            departCode: userInfo.departcode,
            userCode:userInfo.usercode,
            userName:userInfo.username,
            phoneInvoiceNumber: paArr,
            eamAllotDetal:''
        }   
    sendPost(updataUrl, jsons, res); 
    function res(res){
        $('#scan1').hide();
        if(res.success=='true'){
            alert(res.msg);
            arr.remove() 
        }else{
            alert(res.msg);
        }
    }
})
$("#submitBtn2").click(function(){
    var datanull =JSONnull;
    var data = Object.assign(datanull,$("#form1").serializeObject()); 
    data.entityName=$("select[name=entityCode]").find("option:selected").text();
    var  arr=[];
    arr.push(data)
    var jsons={
        phoneInvoiceNumber:data.phoneInvoiceNumber+',',
        departCode: userInfo.departcode ,
        userCode:userInfo.departcode,
        userName:userInfo.username,
        eamAllotDetal:JSON.stringify(arr) 
    }
    var Durl =  getURL()+"/mobile/allotController.do?allotIn";

    sendPost(Durl, jsons, function(data){  
       if(data.success=='true'){
           alert(data.msg);
           $(".backF").click();
            $("#form1").reset();
           getDate(); 
       }else{
           alert(data.msg)
       }
    })



})
function check(event){
    $(event).siblings().find(".chose").removeClass("active");
    $(event).find(".chose").addClass("active");
    var Purl =  getURL()+"/mobile/allotController.do?getByPhoneInvoiceNumber";

    var jsons={
        phoneInvoiceNumber:$(event).attr("data-ph"),
        departCode: userInfo.departcode ,
    }
    sendPost(Purl, jsons, function(data){  
        var res={};
        res.data = data.data;
        ScrapList = data.data;
        var tmpl = doT.template($("#listCon2").text()); 
        $(".cadI").show(); 
        $(".cadL").hide();
        $(".backF").show();
        $(".backT").hide(); 
        if(data.data.length>0){    
            $("#list2").html(tmpl(res));   
        }
        
    })
} 
$(".backF").click(function(){
    $(".cadI").hide(); 
    $(".cadL").show();
    $(".backF").hide();
    $(".backT").show(); 
})
//详情
function check2(event){
    $(event).siblings().find(".chose").removeClass("active");
    $(event).find(".chose").addClass("active");
    var resD=ScrapList.filter(function(index) {
            return  index.id==$(event).attr("data-id");
        })[0] ;
        JSONnull=resD;
        $.each($("#form1 input[name],#form1 select[name]"), function () {
			var that = $(this);
			var nameData = $(this).attr('name');
			var jValue = ""
			for (var item in resD) {
				if (item == nameData) {  //item 表示Json串中的属性，如'name'  
					jValue = resD[item];//key所对应的value  
					that.val(jValue == "" ? "" : jValue);
					return;
				}
			} 
		})
}
//获取. 列表
function getDate(){ 
    var updataUrl =getURL()+'/mobile/allotController.do?queryAllotIn'; 
    var jsons = {  
        departCode: userInfo.departcode,
        userCode: userInfo.usercode,
        userName:userInfo.username,
        phoneInvoiceNumber:$(".chose.active").closest('li').attr("data-ph"),
    }    
    sendPost(updataUrl, jsons, tab2F); 
    function tab2F(data){  
        if(data.success=='false'){
            alert("data.msg");
            return false;
        }
        var resData={};
        resData.data=data.data; 
        var tmpl = doT.template($("#listCon1").text());  
        if(data.data.length>0){   
            //userName
            $("#list").html(tmpl(resData));   
        }else{ 
            $("#list").html("<li class='nodate center'>暂无数据</li>"); 
        } 
    }  
}
 
</script>
</html>

